{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": "container",
    "height": 320,
    "padding": {"top": 25, "left": 10, "right": 10},
    "title": {
        "text": "Ridership per Train Line (2021 - 2024)"
    },

    "data": {
        "url": "https://raw.githubusercontent.com/jsoh06/FIT3179-Data-Visualisation-2/refs/heads/main/Week%2010%20Homework/data/ridership_headline.csv"
        },
    "params": [
        {
            "name": "year_selection",
            "value": 2021,
            "bind": {
                "input": "select",
                "options": [2021, 2022, 2023, 2024, "Overall"],
                "labels": ["2021", "2022", "2023", "2024", "2021-2024 (Overall)"],
                "name": "Select Year: "
            }
        }
    ],
    "transform": [
        {
            "calculate": "time(datum.date)",
            "as": "date_parsed"
        },
        {
            "calculate": "year(datum.date_parsed)",
            "as": "year"
        },
        {
            "calculate": "month(datum.date_parsed)",
            "as": "month"
        },
        {
            "calculate": "['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'][datum.month - 1]",
            "as": "month_name"
        },
        {
            "fold": [
                "rail_lrt_ampang",
                "rail_mrt_kajang",
                "rail_lrt_kj",
                "rail_monorail",
                "rail_ets",
                "rail_intercity",
                "rail_komuter_utara"
            ],
            "as": ["Train_Line", "Ridership"]
        },
        {
            "calculate": "datum.Train_Line == 'rail_lrt_ampang' ? 'LRT Ampang Line' : datum.Train_Line == 'rail_lrt_kj' ? 'LRT Kelana Jaya Line' : datum.Train_Line == 'rail_monorail' ? 'Monorail Line' : datum.Train_Line == 'rail_mrt_kajang' ? 'MRT Kajang Line' : datum.Train_Line == 'rail_ets' ? 'KTMB ETS' : datum.Train_Line == 'rail_intercity' ? 'KTM Intercity' : datum.Train_Line == 'rail_komuter_utara' ? 'KTM Komuter Utara' : datum.Train_Line",
            "as": "Train_Line_Label"
        }        
    ],
        "layer": [
            {
                "transform": [
                    {"filter": "year_selection != 'Overall'"},
                    {"filter": "datum.year == year_selection"},
                     {
                        "aggregate": [{
                        "op": "sum",
                        "field": "Ridership",
                        "as": "Monthly_Ridership"
                        }],
                        "groupby": ["year", "month", "month_name", "Train_Line_Label"]
                }
    ],
    "mark": {
        "type": "line",
        "point": true
    },
    "encoding": {
    "x": {
        "field": "month",
        "type": "quantitative",
        "title": "Month",
        "axis": {
            "tickCount": 12,
            "values": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12],
            "labelExpr": "['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][datum.value - 1]"
        }
    },
        "y": {
            "field": "Monthly_Ridership",
            "type": "quantitative",
            "title": "Trip Count"
        },
        "color": {
            "field": "Train_Line_Label",
            "type": "nominal",
            "title": "Train Line",
            "scale": {
                "domain": [
                    "LRT Ampang Line",
                    "MRT Kajang Line", 
                    "LRT Kelana Jaya Line",
                    "Monorail Line",
                    "KTMB ETS",
                    "KTM Intercity",
                    "KTM Komuter Utara"
                ],
                "range": [
                    "#e41a1c",
                    "#377eb8",
                    "#4daf4a",
                    "#984ea3",
                    "#ff7f00",
                    "#ffff33",
                    "#a65628"                   
                ]
            }
        },
        "tooltip": [
            {"field": "month_name", "type": "nominal", "title": "Month"},
            {"field": "Train_Line_Label", "type": "nominal", "title": "Train Line"},
            {"field": "Monthly_Ridership", "type": "quantitative", "title": "Number of Trips", "format": ","}
        ]
    }
},
{
    "transform": [
        {"filter": "year_selection == 'Overall'"},
        {"filter": "datum.year >= 2021 && datum.year <= 2024"},
         {
            "aggregate": [{
            "op": "sum",
            "field": "Ridership",
            "as": "Yearly_Ridership"
            }],
            "groupby": ["year", "Train_Line_Label"]
        }
    ],
    "mark": {
        "type": "line",
        "point": true
    },
    "encoding": {
        "x": {
            "field": "year",
            "type": "ordinal",
            "title": "Year",
            "axis": {
                "labelAngle": 0,
                "labelPadding": 8,
                "titlePadding": 15
            }
        },
    "y": {
        "field": "Yearly_Ridership",
        "type": "quantitative",
        "title": "Trip Count"
    },
    "color": {
        "field": "Train_Line_Label",
        "type": "nominal",
        "title": "Train Line",
        "scale": {
            "domain": [
                "LRT Ampang Line",
                "MRT Kajang Line", 
                "LRT Kelana Jaya Line",
                "Monorail Line",
                "KTMB ETS",
                "KTM Intercity",
                "KTM Komuter Utara"
            ],
            "range": [
                "#e41a1c",
                "#377eb8",
                "#4daf4a",
                "#984ea3",
                "#ff7f00",
                "#ffff33",
                "#a65628"                   
            ]
        }
    },
    "tooltip": [
        {"field": "year", "type": "ordinal", "title": "Year"},
        {"field": "Train_Line_Label", "type": "nominal", "title": "Train Line"},
        {"field": "Yearly_Ridership", "type": "quantitative", "title": "Number of Trips", "format": ","}
                ]
            }
        }
    ]
}


